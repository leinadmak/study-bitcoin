<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bitcoin Mining Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
    margin:0;
    font-family:'Orbitron', sans-serif;
    background:#0f0f0f;
    color:#00ff00;
    height:100vh;
    display:flex;
    flex-direction:row;
    flex-wrap:wrap;
    overflow:hidden;
}
#simContainer {
    display:flex;
    flex-direction:row;
    flex-wrap:wrap;
    width:100%;
    height:100%;
}
#miningSimulator {
    flex:1 1 300px;
    min-width:300px;
    max-width:520px;
    background:rgba(0,0,0,0.85);
    padding:14px;
    border-radius:10px;
    box-shadow:0 0 12px #00ff00;
    margin:10px;
    box-sizing:border-box;
}
.sim-title {font-size:18px; font-weight:bold; margin-bottom:8px;}
.progress-container {background:#111; border:1px solid #00ff00; border-radius:6px; width:100%; height:12px; margin-top:6px; overflow:hidden;}
.progress-bar {height:100%; width:0%; border-radius:6px; transition: width 0.3s, background-color 0.3s;}
#blockCounter, #progressText {font-size:12px; margin-top:4px; opacity:0.8;}
button {cursor:pointer; padding:6px 12px; font-weight:bold; margin-top:8px;}
#toast {
    position: fixed;
    right: 20px;
    top: 20px;
    background: rgba(0,255,0,0.9);
    color: #0f0f0f;
    padding: 12px 16px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    z-index: 30;
    opacity: 0;
    transition: opacity 0.4s ease-in-out;
}

/* History panel */
#historyPanel {
    flex:1 1 200px;
    min-width:200px;
    max-width:400px;
    background:rgba(0,0,0,0.85);
    margin:10px;
    padding:14px;
    border-radius:10px;
    box-shadow:0 0 12px #00ff00;
    overflow-y:auto;
    box-sizing:border-box;
    height:calc(100% - 20px);
}
#historyPanel table {
    width:100%;
    border-collapse:collapse;
}
#historyPanel th, #historyPanel td {
    font-size:12px;
    padding:4px 6px;
    text-align:left;
}
#historyPanel td.hash {
    font-family:monospace;
    word-break:break-all;
}
#historyPanel td.blockNum {
    font-weight:bold;
}
@media(max-width:800px){
    #simContainer {flex-direction:column;}
    #historyPanel {height:auto; max-height:300px;}
}
</style>
</head>
<body>
<div id="simContainer">
    <div id="miningSimulator">
        <div class="sim-title">Bitcoin Mining Simulator</div>
        <label>Speed (hashes/sec): <span id="speedLabel">1</span></label><br>
        <input id="speedInput" type="range" min="1" max="20" value="1">
        <label style="margin-top:8px;">Difficulty (leading zeros): <span id="difficultyLabel">3</span></label><br>
        <input id="difficultyInput" type="range" min="1" max="6" value="3">
        <div style="margin-top:12px;">Attempts: <span id="mineAttempts">0</span></div>
        <div style="margin-top:8px;">Last Hash:<br><span id="mineHash" style="display:block;word-break:break-all;">â€”</span></div>
        <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
        <div id="progressText">Progress: 0%</div>
        <div id="blockCounter">Blocks found: 0</div>
        <button id="startMineBtn">Start Mining</button>
        <button id="stopMineBtn" style="background:#ff3333;color:#0f0f0f;margin-left:8px;">Stop</button>
    </div>

    <div id="historyPanel">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Hash</th>
                </tr>
            </thead>
            <tbody id="historyBody">
            </tbody>
        </table>
    </div>
</div>

<div id="toast"></div>

<script>
function showToast(message){
    const toast = document.getElementById("toast");
    toast.innerText = message;
    toast.style.opacity = 1;
    setTimeout(()=>{toast.style.opacity=0;},3000);
}

/* Web Worker */
let worker = new Worker('miner.worker.js');
const speedInput = document.getElementById("speedInput");
const difficultyInput = document.getElementById("difficultyInput");

speedInput.addEventListener("input", e => {
    const speed = parseInt(e.target.value);
    document.getElementById("speedLabel").innerText = speed;
    worker.postMessage({type:'updateSpeed', speed});
});

difficultyInput.addEventListener("input", e => {
    const difficulty = parseInt(e.target.value);
    document.getElementById("difficultyLabel").innerText = difficulty;
    worker.postMessage({type:'updateDifficulty', difficulty});
});

document.getElementById("startMineBtn").addEventListener("click", ()=>worker.postMessage({type:'start'}));
document.getElementById("stopMineBtn").addEventListener("click", ()=>worker.postMessage({type:'stop'}));

const historyBody = document.getElementById("historyBody");
const difficultyColors = ["#00ff00","#00ffff","#ffff00","#ff9900","#ff0000","#9900ff"];

worker.onmessage = (e)=>{
    const {mineHash, attempts, blocksFound, progress, lastBlock} = e.data;
    if(mineHash!==undefined) document.getElementById("mineHash").innerText = mineHash;
    if(attempts!==undefined) document.getElementById("mineAttempts").innerText = attempts;
    if(blocksFound!==undefined) document.getElementById("blockCounter").innerText = `Blocks found: ${blocksFound}`;
    if(progress!==undefined){
        const bar = document.getElementById("progressBar");
        bar.style.width = progress + "%";
        bar.style.backgroundColor = `hsl(${progress*1.2},100%,50%)`;
        document.getElementById("progressText").innerText = `Progress: ${progress.toFixed(2)}%`;
    }
    if(lastBlock){
        const row = document.createElement("tr");
        const numCell = document.createElement("td");
        numCell.innerText = lastBlock.number;
        numCell.className="blockNum";
        const hashCell = document.createElement("td");
        hashCell.innerText = lastBlock.hash;
        hashCell.className="hash";
        hashCell.style.color = difficultyColors[lastBlock.difficulty-1] || "#00ff00";
        historyBody.prepend(row);
        row.appendChild(numCell);
        row.appendChild(hashCell);
        // Keep last 50 blocks
        while(historyBody.rows.length>50) historyBody.deleteRow(50);
    }
};
</script>
</body>
</html>
